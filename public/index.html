<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mitta Movies - Stream Movies & TV Shows</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div id="app">
        <div id="profileGate" class="profile-gate" role="dialog" aria-modal="true" aria-labelledby="profileGateTitle" hidden>
            <div class="profile-gate-content">
                <div class="profile-gate-logo">
                    <span class="logo-mark">MM</span>
                    <span class="logo-text">Mitta</span>
                </div>
                <h2 id="profileGateTitle">Who's watching?</h2>
                <p class="profile-gate-subtitle">Select a profile to start watching.</p>
                <div id="profileList" class="profile-list"></div>
                <p class="profile-gate-footer">You can switch profiles any time from the header.</p>
            </div>
        </div>
        <div id="profileSettingsModal" class="profile-settings-modal" role="dialog" aria-modal="true" aria-labelledby="profileSettingsTitle" hidden>
            <div class="profile-settings-content">
                <div class="profile-settings-header">
                    <h3 id="profileSettingsTitle" class="profile-settings-title">Profile settings</h3>
                    <button id="profileSettingsClose" class="profile-settings-close" type="button" aria-label="Close profile settings">✕</button>
                </div>
                <form id="profileSettingsForm">
                    <div class="profile-settings-grid">
                        <div class="profile-settings-field">
                            <label for="profileDisplayName">Display name</label>
                            <input id="profileDisplayName" name="displayName" type="text" maxlength="16" autocomplete="off" />
                        </div>
                        <div class="profile-settings-field">
                            <label for="profileAvatarInput">Avatar initials</label>
                            <input id="profileAvatarInput" name="avatar" type="text" maxlength="2" autocomplete="off" />
                        </div>
                        <div class="profile-settings-field">
                            <label for="profileAccent">Accent colour</label>
                            <input id="profileAccent" name="accentColor" type="color" />
                        </div>
                        <div class="profile-settings-field">
                            <label for="profileAutoplay">Autoplay trailers</label>
                            <select id="profileAutoplay" name="autoplay">
                                <option value="on">On</option>
                                <option value="off">Off</option>
                            </select>
                        </div>
                        <div class="profile-settings-field">
                            <label for="profileSubtitleSize">Subtitle size</label>
                            <select id="profileSubtitleSize" name="subtitleSize">
                                <option value="small">Small</option>
                                <option value="medium">Medium</option>
                                <option value="large">Large</option>
                            </select>
                        </div>
                        <div class="profile-settings-field">
                            <label for="profileAudioLang">Audio language</label>
                            <select id="profileAudioLang" name="audioLang">
                                <option value="en">English</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                            </select>
                        </div>
                        <div class="profile-settings-field">
                            <label for="profileMaturity">Maturity rating</label>
                            <select id="profileMaturity" name="maturity">
                                <option value="all">All titles</option>
                                <option value="pg">PG</option>
                                <option value="m">M</option>
                                <option value="ma15">MA15+</option>
                            </select>
                        </div>
                    </div>
                    <div class="profile-settings-actions">
                        <button id="profileSettingsReset" class="profile-settings-reset" type="button">Reset</button>
                        <button class="profile-settings-save" type="submit">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- Header -->
        <header class="header">
            <div class="header-container">
                <div class="header-left">
                    <button id="profileChip" class="profile-chip" type="button" aria-label="Profile">
                        <span id="profileAvatar" class="profile-avatar">G</span>
                        <span id="profileName" class="profile-name">Guest</span>
                    </button>
                    <nav class="main-nav">
                        <button id="homeBtn" class="nav-link active">Home</button>
                        <button id="tvShowsBtn" class="nav-link">Shows</button>
                        <button id="moviesBtn" class="nav-link">Movies</button>
                        <button id="exploreBtn" class="nav-link">Games</button>
                        <button id="historyBtn" class="nav-link">My Library</button>
                    </nav>
                </div>
                <div class="header-right">
                    <div class="search-icon-container">
                        <input type="text" id="searchInputHeader" class="search-input-header" placeholder="Search movies or shows..." />
                        <button id="searchClearHeader" class="search-clear-btn header-search-clear" type="button" aria-label="Clear search" aria-hidden="true">✕</button>
                        <button id="searchToggle" class="search-icon-btn" aria-label="Open search">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                    </div>
                    <select id="providerSelect" class="provider-select-compact">
                        <option value="vidsrc">Vidsrc (IMDB)</option>
                    </select>
                    <div class="profile-controls">
                        <button id="profileSettingsTrigger" class="profile-settings-trigger" type="button" aria-label="Profile settings" hidden>
                            ⚙
                        </button>
                    </div>
                    <div class="logo-container" aria-label="Brand">
                        <span class="logo-mark">MM</span>
                        <span class="logo-text">Mitta</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Loading Indicator -->
                <div id="loading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading...</p>
                </div>

                <!-- Home View -->
                <div id="homeView" class="view">
                    <div class="seasonal-decor" aria-hidden="true">
                        <div class="decor decor-halloween">
                            <svg class="decor-icon decor-icon-lg" viewBox="0 0 120 120" role="img" aria-label="Spooky pumpkin">
                                <path d="M60 18c6-10 18-12 26-6-7 2-12 7-14 14 16 4 30 18 30 38 0 24-19 40-42 40S18 88 18 64c0-20 13-34 30-38-2-7-7-12-14-14 8-6 20-4 26 6z" fill="currentColor"/>
                                <path d="M42 64l10-8 8 8 8-8 10 8-10 8-8-8-8 8-10-8z" fill="#12060f"/>
                                <circle cx="45" cy="60" r="6" fill="#12060f"/>
                                <circle cx="75" cy="60" r="6" fill="#12060f"/>
                            </svg>
                            <svg class="decor-icon" viewBox="0 0 120 120" role="img" aria-label="Haunted moon">
                                <circle cx="60" cy="60" r="42" fill="currentColor"/>
                                <circle cx="78" cy="48" r="8" fill="#12060f"/>
                                <circle cx="54" cy="36" r="6" fill="#12060f"/>
                                <circle cx="48" cy="72" r="10" fill="#12060f"/>
                            </svg>
                        </div>
                        <div class="decor decor-valentines">
                            <svg class="decor-icon decor-icon-lg" viewBox="0 0 120 120" role="img" aria-label="Heart">
                                <path d="M60 96s-30-18-42-36c-10-15-4-36 14-40 12-3 22 4 28 12 6-8 16-15 28-12 18 4 24 25 14 40C90 78 60 96 60 96z" fill="currentColor"/>
                            </svg>
                            <svg class="decor-icon" viewBox="0 0 120 120" role="img" aria-label="Rose">
                                <path d="M60 18c16 0 26 12 26 26 0 12-8 22-20 24 8 4 12 12 12 20 0 16-10 26-18 26s-18-10-18-26c0-8 4-16 12-20-12-2-20-12-20-24 0-14 10-26 26-26z" fill="currentColor"/>
                            </svg>
                        </div>
                        <div class="decor decor-christmas">
                            <svg class="decor-icon decor-icon-lg" viewBox="0 0 120 120" role="img" aria-label="Snowflake">
                                <path d="M58 10h4l4 14 12-8 2 4-12 8 12 8-2 4-12-8-4 14h-4l-4-14-12 8-2-4 12-8-12-8 2-4 12 8 4-14z" fill="currentColor"/>
                                <circle cx="60" cy="60" r="10" fill="#0b1b12"/>
                            </svg>
                            <svg class="decor-icon" viewBox="0 0 120 120" role="img" aria-label="Ornament">
                                <circle cx="60" cy="64" r="28" fill="currentColor"/>
                                <rect x="52" y="22" width="16" height="16" rx="4" fill="#0b1b12"/>
                            </svg>
                        </div>
                        <div class="decor decor-newyear">
                            <svg class="decor-icon decor-icon-lg" viewBox="0 0 120 120" role="img" aria-label="Firework burst">
                                <path d="M60 18l6 22 22-6-16 16 16 16-22-6-6 22-6-22-22 6 16-16-16-16 22 6 6-22z" fill="currentColor"/>
                            </svg>
                            <svg class="decor-icon" viewBox="0 0 120 120" role="img" aria-label="Sparkle">
                                <path d="M60 28l8 16 16 8-16 8-8 16-8-16-16-8 16-8 8-16z" fill="currentColor"/>
                            </svg>
                        </div>
                    </div>
                    <div id="searchMenu" class="search-menu" hidden>
                        <div class="search-menu-header">
                            <div class="search-menu-title">
                                <h2 id="searchMenuTitle">Search Results</h2>
                                <p class="search-menu-subtitle">Search TMDB movies and TV shows</p>
                            </div>
                        </div>
                        <div class="search-menu-summary">
                            <div id="searchSummary" class="search-summary-text"></div>
                            <div id="searchProviderFilters" class="search-provider-filters"></div>
                        </div>
                        <div class="search-menu-body">
                            <div id="searchMenuResults" class="posts-grid search-results-grid"></div>
                        </div>
                    </div>
                    <div id="catalogSections"></div>
                </div>

                <!-- Search Results View -->
                <div id="searchView" class="view" style="display: none;">
                    <h2 id="searchTitle">Search Results</h2>
                    <div id="searchResults" class="posts-grid"></div>
                    <div id="searchPagination" class="pagination"></div>
                </div>

                <!-- Details View -->
                <div id="detailsView" class="view" style="display: none;">
                    <button id="backBtn" class="back-btn">← Back</button>
                    <div id="detailsContent"></div>
                </div>

                <!-- Player View -->
                <div id="playerView" class="view" style="display: none;">
                    <button id="playerBackBtn" class="back-btn">← Back to Details</button>
                    
                    <!-- Error Message (Player Only) -->
                    <div id="errorMessage" class="error-message" style="display: none;"></div>

                    <div id="adblockPrompt" class="adblock-prompt" hidden>
                        <div class="adblock-prompt__content">
                            <div>
                                <p class="adblock-prompt__title">Annoying ads or redirects?</p>
                                <p class="adblock-prompt__body">For the best experience on MittaMovies, install uBlock Origin — free &amp; open-source.</p>
                            </div>
                            <div class="adblock-prompt__actions">
                                <button id="adblockInstallBtn" class="adblock-btn primary" type="button">Install uBlock Origin</button>
                                <button id="adblockBraveBtn" class="adblock-btn" type="button">Try Brave Browser</button>
                                <button id="adblockDismissBtn" class="adblock-btn ghost" type="button">Continue anyway</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="playerContent">
                        <div id="playerMeta" class="player-meta"></div>
                        <div id="providerSelector" class="provider-selector"></div>
                        <div class="video-stage">
                            <video id="videoPlayer" class="video-player" controls></video>
                            <div id="movieIntroOverlay" class="movie-intro-overlay" aria-hidden="true">
                                <video id="movieIntroVideo" class="movie-intro-video" preload="auto"></video>
                            </div>
                        </div>
                        <div id="tmdbPlayerContainer" class="tmdb-player-container" style="display: none;">
                            <div id="tmdbPlayerMessage" class="tmdb-player-message"></div>
                            <div id="tmdbPlayerToolbar" class="tmdb-player-toolbar" hidden>
                                <div class="tmdb-player-actions">
                                    <button id="tmdbDirectBtn" class="tmdb-player-btn is-active" type="button">Direct Player</button>
                                    <button id="tmdbCleanBtn" class="tmdb-player-btn" type="button">Clean Player (Beta)</button>
                                </div>
                                <p id="tmdbCleanStatus" class="tmdb-player-status">Best effort clean mode. Falls back automatically if the proxy fails.</p>
                            </div>
                            <div id="tmdbIframeContainer" class="tmdb-iframe-container"></div>
                            <div id="tmdbTvControls" class="tmdb-tv-controls" hidden>
                                <div class="tmdb-tv-header">
                                    <h2 id="tmdbTvTitle">TV Show</h2>
                                    <p id="tmdbTvEpisodeMeta" class="tmdb-tv-episode-meta"></p>
                                </div>
                                <div class="tmdb-tv-selects">
                                    <label>
                                        Season
                                        <select id="tmdbSeasonSelect"></select>
                                    </label>
                                    <label>
                                        Episode
                                        <select id="tmdbEpisodeSelect"></select>
                                    </label>
                                </div>
                                <div class="tmdb-tv-actions">
                                    <button id="tmdbPrevEpisode" class="tmdb-episode-btn" type="button">Prev</button>
                                    <button id="tmdbNextEpisode" class="tmdb-episode-btn" type="button">Next</button>
                                </div>
                            </div>
                        </div>
                        <div id="streamSelector" class="stream-selector"></div>
                        <div id="playerEpisodes" class="player-episodes"></div>
                    </div>
                </div>

                <!-- Explore View -->
                <div id="exploreView" class="view" style="display: none;">
                    <button id="exploreBackBtn" class="back-btn">← Back</button>
                    <div id="exploreContent"></div>
                </div>

                <!-- Movies View -->
                <div id="moviesView" class="view" style="display: none;">
                    <button id="moviesBackBtn" class="back-btn">← Back</button>
                    <div id="moviesContent"></div>
                </div>

                <!-- TV Shows View -->
                <div id="tvShowsView" class="view" style="display: none;">
                    <button id="tvShowsBackBtn" class="back-btn">← Back</button>
                    <div id="tvShowsContent"></div>
                </div>

                <!-- History View -->
                <div id="historyView" class="view" style="display: none;">
                    <button id="historyBackBtn" class="back-btn">← Back</button>
                    <div id="historyContent"></div>
                </div>

            </div>
        </main>

    <script src="/env.js"></script>
    <script src="/tmdb-config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="/history.js"></script>
    <script src="/tmdb-content.js"></script>
    <script src="/app.js"></script>
    <script src="/explore.js"></script>
    <script src="/movies.js"></script>
    <script src="/tvshows.js"></script>
</body>
</html>
